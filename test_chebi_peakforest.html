<html>
    <head>
        <meta charset="utf-8">

	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/emetabohub/chebi-discovery@optim_big_list/dist/chebi-discovery-web.js"> </script>
	
        <script>
	/* ----------------------getChebiIdsFromPeakforest--------------------------------------------      */
        function getChebiIdsFromPeakforest() { 
        let config = SWDiscoveryConfiguration.setConfigString(`
		{
		     "sources" : [{
		       "id"  : " - Peakforest Metabolomics - ",
		       "url" : "https://peakforest.semantic-metabolomics.fr/sparql"
		     }],
		     "settings" : {
		       "logLevel" : "off"
		     }
		}
		`);

	let query = SWDiscovery(config)
                     .something()
                      .isSubjectOf("https://metabohub.peakforest.org/ontology/property#chEBI","chebId")
                        .select("chebId")
                        .commit()
                        .raw()
                        .then((response) => {
                                let listChebidPeakforest = response.results.bindings.map( obj => obj.chebId.value);
				$("#chebIds").html(JSON.stringify(listChebidPeakforest));
                                metabolomics2NetworkPeakforest(listChebidPeakforest);                               
                         });                   
        }  
        /* ----------------------metabolomics2NetworkPeakforest--------------------------------------------      */
	function metabolomics2NetworkPeakforest(lIdChebis) { 
			let config = `
			{
			     "sources" : [{
			       "id"  : " - Forum Semantic Metabolomics - ",
			       "url" : "https://forum.semantic-metabolomics.fr/sparql"
			     }],
			     "settings" : {
			       "logLevel" : "off"
			     }
			}
			`

			/*
			    ---------------------------
			    Metabolomics2Network
			*/

			{
		
			ChebiDiscovery(config)
			   .ontology_based_matching(lIdChebis)
			       .then ( (lTupleObject) => {
			       $("#metabolomics2network")
				 .html("<h3>ontology based matching of</h3> <pre>"+ JSON.stringify(lIdChebis)+"</pre><br/><code style=\"color:#FF0000\">"+JSON.stringify(lTupleObject)+"</code>")
				})
				.catch( msg => { console.error(msg) ; } ) ;
			}
	}
         
	/* ----------------------------------------------------     */	
	/*                Main -----------------*/

	getChebiIdsFromPeakforest() ;
	</script>
     </head>
  <body>
    <h1> Demo ChebiDiscovery/Peakforest </h1>

    <h2> I. Get Peakforest ChebIds</h2>
    <div id="chebIds"></div>

    <h2> II. Metabolomics2Network</h2>
    <div id="metabolomics2network"></div>

    </body>

</html>
